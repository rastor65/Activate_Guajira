"use strict";(self.webpackChunkAppTuristica=self.webpackChunkAppTuristica||[]).push([[410],{2410:(z,a,s)=>{s.r(a),s.d(a,{RolesRecursosModule:()=>Y});var u=s(9808),d=s(620),e=s(4893),m=s(3662),f=s(4765),g=s(520),R=s(2340);let C=(()=>{class n{constructor(o){this.http=o,this.API_URI=R.N.API_URI,this.base_recursos=`${this.API_URI}/resources/`,this.base_recursos_rol=`${this.API_URI}/resourcesr/`}getResources(){return this.http.get(this.base_recursos)}createResource(o){return this.http.post(this.base_recursos,o)}updateResource(o,t){return this.http.put(`${this.base_recursos}${o}/`,t)}deleteResource(o){return this.http.delete(`${this.base_recursos}${o}/`)}assignResourceToRole(o,t){return this.http.post(this.base_recursos_rol,{resource:o,role:t,status:!0})}deleteResourceFromRole(o){const t=`${this.base_recursos_rol}/resourcesr/${o}`,r=new g.WM({"Content-Type":"application/json"});return this.http.delete(t,{headers:r})}getAssignedRolesToResources(){return this.http.get(`${this.base_recursos_rol}`)}}return n.\u0275fac=function(o){return new(o||n)(e.LFG(g.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var b=s(9783),p=s(4036),l=s(3075);function _(n,c){if(1&n&&(e.TgZ(0,"th",14),e._uU(1),e.qZA()),2&n){const o=c.$implicit;e.xp6(1),e.Oqu(o.name)}}function x(n,c){if(1&n&&(e.TgZ(0,"td")(1,"label",19),e._UZ(2,"input",20)(3,"span",21),e.qZA()()),2&n){const o=c.$implicit,t=e.oxw().$implicit,r=e.oxw();e.xp6(2),e.Q6J("checked",r.hasAccess(o.id,t.id))}}function M(n,c){if(1&n&&(e.TgZ(0,"td")(1,"label",19),e._UZ(2,"input",20)(3,"span",21),e.qZA()()),2&n){const o=c.$implicit,t=e.oxw().$implicit,r=e.oxw(2);e.xp6(2),e.Q6J("checked",r.hasAccess(o.id,t.id))}}function O(n,c){if(1&n&&(e.TgZ(0,"td")(1,"label",19),e._UZ(2,"input",20)(3,"span",21),e.qZA()()),2&n){const o=c.$implicit,t=e.oxw().$implicit,r=e.oxw(3);e.xp6(2),e.Q6J("checked",r.hasAccess(o.id,t.id))}}function v(n,c){if(1&n&&(e.ynx(0),e.TgZ(1,"tr",23)(2,"td"),e._uU(3),e.qZA(),e.YNc(4,O,4,1,"td",17),e.qZA(),e.BQk()),2&n){const o=c.$implicit,t=e.oxw(3);e.xp6(3),e.hij("\u21b3\u21b3 ",o.titulo,""),e.xp6(1),e.Q6J("ngForOf",t.roles)}}function P(n,c){if(1&n&&(e.ynx(0),e.TgZ(1,"tr",22)(2,"td"),e._uU(3),e.qZA(),e.YNc(4,M,4,1,"td",17),e.qZA(),e.YNc(5,v,5,2,"ng-container",17),e.BQk()),2&n){const o=c.$implicit,t=e.oxw(2);e.xp6(3),e.hij("\u21b3 ",o.titulo,""),e.xp6(1),e.Q6J("ngForOf",t.roles),e.xp6(1),e.Q6J("ngForOf",o.children)}}function T(n,c){if(1&n&&(e.ynx(0),e.TgZ(1,"tr",18)(2,"td"),e._uU(3),e.qZA(),e.YNc(4,x,4,1,"td",17),e.qZA(),e.YNc(5,P,6,3,"ng-container",17),e.BQk()),2&n){const o=c.$implicit,t=e.oxw();e.xp6(3),e.Oqu(o.titulo),e.xp6(1),e.Q6J("ngForOf",t.roles),e.xp6(1),e.Q6J("ngForOf",o.children)}}const Z=[{path:"crear",component:(()=>{class n{constructor(o,t,r,i){this.recursosService=o,this.rolesService=t,this.recursosRolesService=r,this.messageService=i,this.roles=[],this.resources=[],this.selectedRole=0,this.selectedResource=0,this.assignedRolesToResources={}}ngOnInit(){this.cargarRolesRecursos()}cargarRolesRecursos(){this.rolesService.getRoles().subscribe(o=>{this.roles=o}),this.recursosService.getResources().subscribe(o=>{this.resources=this.buildResourceHierarchy(o),this.loadAssignedRolesToResources()})}agregarRecursoRol(){this.selectedRole&&this.selectedResource&&this.recursosRolesService.assignResourceToRole(this.selectedResource,this.selectedRole).subscribe(o=>{this.messageService.add({severity:"success",summary:"\xc9xito",detail:"Recurso agregado al rol."}),this.cargarRolesRecursos()},o=>{console.error("Error del servidor:",o),this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo agregar el recurso al rol."})})}eliminarRecursoRol(o){confirm("\xbfEst\xe1s seguro de que deseas eliminar esta relaci\xf3n?")&&this.recursosRolesService.deleteResourceFromRole(o).subscribe(t=>{this.messageService.add({severity:"success",summary:"\xc9xito",detail:"Relaci\xf3n eliminada."})},t=>{console.error("Error del servidor:",t),this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la relaci\xf3n."})})}buildResourceHierarchy(o){const t={},r=[];return o.forEach(i=>{t[i.id]=i,i.children=[]}),o.forEach(i=>{if(0===i.id_padre)r.push(i);else{const h=t[i.id_padre];h&&h.children.push(i)}}),r}flattenResources(o){let t=[];for(const r of o)t.push(r),r.children&&r.children.length>0&&(t=t.concat(this.flattenResources(r.children)));return t}get flattenedResources(){return this.flattenResources(this.resources)}loadAssignedRolesToResources(){this.recursosRolesService.getAssignedRolesToResources().subscribe(o=>{for(const t of o)this.assignedRolesToResources[t.resource]||(this.assignedRolesToResources[t.resource]=[]),this.assignedRolesToResources[t.resource].push(t.role)})}hasAccess(o,t){var r;const i=null===(r=this.assignedRolesToResources)||void 0===r?void 0:r[t];return i&&i.includes(o)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(m.D),e.Y36(f.f),e.Y36(C),e.Y36(b.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-crear"]],decls:34,vars:9,consts:[[1,"recursos-title"],[1,"role-resource-container"],[3,"submit"],[1,"input-group"],[1,"input-container"],["for","selectRole"],["id","selectRole","name","selectedRole","placeholder","Seleccione un rol","optionLabel","name","optionValue","id",3,"options","ngModel","filter","ngModelChange"],["for","selectResource"],["id","selectResource","name","selectResource","placeholder","Seleccione un recurso","optionLabel","titulo","optionValue","id",3,"options","ngModel","filter","ngModelChange"],[1,"button-container"],["type","submit"],[1,"pi","pi-check"],[1,"table-container"],[1,"resource-role-table"],["scope","col"],["scope","colgroup",3,"colSpan"],["scope","col",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"row"],[1,"custom-checkbox"],["type","checkbox",3,"checked"],[1,"custom-label"],[1,"child-row"],[1,"grandchild-row"]],template:function(o,t){1&o&&(e.TgZ(0,"h2",0),e._uU(1,"Asignar Recursos"),e.qZA(),e.TgZ(2,"div",1)(3,"form",2),e.NdJ("submit",function(){return t.agregarRecursoRol()}),e.TgZ(4,"fieldset")(5,"legend"),e._uU(6,"Asignar un recurso a un rol"),e.qZA(),e.TgZ(7,"div",3)(8,"div",4)(9,"label",5),e._uU(10,"Seleccionar un Rol:"),e.qZA(),e.TgZ(11,"p-dropdown",6),e.NdJ("ngModelChange",function(i){return t.selectedRole=i}),e.qZA()(),e.TgZ(12,"div",4)(13,"label",7),e._uU(14,"Seleccionar un Recurso:"),e.qZA(),e.TgZ(15,"p-dropdown",8),e.NdJ("ngModelChange",function(i){return t.selectedResource=i}),e.qZA()()(),e.TgZ(16,"div",9)(17,"button",10),e._UZ(18,"i",11),e._uU(19," Asignar "),e.qZA()()()()(),e.TgZ(20,"div",12)(21,"table",13)(22,"thead")(23,"tr")(24,"th",14),e._uU(25,"RECURSOS"),e.qZA(),e.TgZ(26,"th",15),e._uU(27,"ROLES"),e.qZA()(),e.TgZ(28,"tr")(29,"th",14),e._uU(30,"T\xedtulo"),e.qZA(),e.YNc(31,_,2,1,"th",16),e.qZA()(),e.TgZ(32,"tbody"),e.YNc(33,T,6,3,"ng-container",17),e.qZA()()()),2&o&&(e.xp6(11),e.Q6J("options",t.roles)("ngModel",t.selectedRole)("filter",!0),e.xp6(4),e.Q6J("options",t.flattenedResources)("ngModel",t.selectedResource)("filter",!0),e.xp6(11),e.Q6J("colSpan",t.roles.length),e.xp6(5),e.Q6J("ngForOf",t.roles),e.xp6(2),e.Q6J("ngForOf",t.resources))},dependencies:[u.sg,p.Lt,l._Y,l.JJ,l.JL,l.On,l.F],styles:['.recursos-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:800;color:#1a1a1a;margin-bottom:1rem;text-align:center;text-transform:uppercase;letter-spacing:1px}.role-resource-container[_ngcontent-%COMP%]{max-width:1000px;margin:auto;background:#ffffff;border-radius:16px;padding:2rem;box-shadow:0 8px 28px #0000001a;transition:all .3s ease-in-out}.role-resource-container[_ngcontent-%COMP%]:hover{box-shadow:0 12px 32px #00000026;transform:translateY(-2px)}fieldset[_ngcontent-%COMP%]{border:none;padding:1rem 0}legend[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#007ad9;margin-bottom:1.5rem;text-align:center}.input-group[_ngcontent-%COMP%]{display:flex;gap:2rem;flex-wrap:wrap;justify-content:center}.input-container[_ngcontent-%COMP%]{flex:1 1 300px;display:flex;flex-direction:column;gap:.5rem}.input-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333}  .p-dropdown{border-radius:12px!important;padding:.5rem!important;border:1px solid #ccc!important;background-color:#fdfdfd!important;transition:border-color .3s ease}  .p-dropdown:hover{border-color:#007ad9!important}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:2rem}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#007ad9,#004b93);border:none;color:#fff;font-size:1rem;font-weight:600;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .3s ease-in-out}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#004b93,#003974);transform:translateY(-2px)}.table-container[_ngcontent-%COMP%]{margin-top:2rem;overflow-x:auto;padding:1rem;background-color:#fff;border-radius:12px;box-shadow:0 6px 20px #0000000d}.resource-role-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;text-align:center;font-size:.95rem}.resource-role-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .resource-role-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e0e0e0}.resource-role-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#007ad9;color:#fff;font-weight:700;text-transform:uppercase}.resource-role-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#f9f9f9}.resource-role-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#eef6ff;transition:.2s ease}.row[_ngcontent-%COMP%]{background-color:#eaf4ff;font-weight:600}.child-row[_ngcontent-%COMP%]{background-color:#f3f9ff}.grandchild-row[_ngcontent-%COMP%]{background-color:#f9fcff}.custom-checkbox[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.custom-checkbox[_ngcontent-%COMP%]   .custom-label[_ngcontent-%COMP%]{width:18px;height:18px;display:inline-block;border:2px solid #007ad9;border-radius:4px;position:relative;background:#fff}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-label[_ngcontent-%COMP%]{background-color:#007ad9}.custom-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-label[_ngcontent-%COMP%]:after{content:"\\2714";color:#fff;font-size:12px;position:absolute;top:1px;left:3px}@media (max-width: 768px){.recursos-title[_ngcontent-%COMP%]{font-size:1.5rem}.role-resource-container[_ngcontent-%COMP%]{padding:1rem}.input-group[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.input-container[_ngcontent-%COMP%]{min-width:100%}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;font-size:.95rem}.resource-role-table[_ngcontent-%COMP%]{font-size:.85rem}.resource-role-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .resource-role-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]{padding:.5rem}}']}),n})()}];let y=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.Bz.forChild(Z),d.Bz]}),n})();var A=s(6697),S=s(845),w=s(9114),U=s(8061),J=s(5315),k=s(1424),$=s(657),F=s(2145),Q=s(1497),N=s(4297);let Y=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.ez,y,p.kW,A.U$,S.hJ,w.D,U.Q,J.S,k.j,l.u5,l.UX,$.kK,F.WN,Q.EV,N.d]}),n})()}}]);