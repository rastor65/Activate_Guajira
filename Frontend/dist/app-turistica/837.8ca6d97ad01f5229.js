"use strict";(self.webpackChunkAppTuristica=self.webpackChunkAppTuristica||[]).push([[837],{2837:(Q,f,i)=>{i.r(f),i.d(f,{UserRolesModule:()=>F});var g=i(9808),v=i(620),m=i(520),e=i(4893),b=i(4738),y=i(9783),S=i(1208),u=i(3075),R=i(2145);function M(n,l){if(1&n){const o=e.EpF();e.TgZ(0,"div")(1,"p-checkbox",10),e.NdJ("ngModelChange",function(r){e.CHM(o);const t=e.oxw(2);return e.KtG(t.rolesSeleccionados=r)}),e.qZA()()}if(2&n){const o=l.$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("inputId","rol_"+o.id)("value",o.id)("binary",!0)("label",o.name)("ngModel",s.rolesSeleccionados)("name","rol_"+o.id)}}function C(n,l){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,M,2,6,"div",9),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.roles)}}function U(n,l){if(1&n&&(e.ynx(0),e.TgZ(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA()(),e.BQk()),2&n){const o=l.$implicit;e.xp6(3),e.Oqu(o.key),e.xp6(2),e.Oqu(o.value.join(", "))}}const O=[{path:"ver",component:(()=>{class n{constructor(o,s,r){this.usuariosService=o,this.messageService=s,this.http=r,this.usuarios=[],this.roles=[],this.usuarioSeleccionado={},this.AllRoles=[],this.usuarioRolesMap=new Map,this.filteredUsuarios=[],this.rolesSeleccionados=[],this.nuevosRolesSeleccionados=[]}ngOnInit(){this.usuariosService.getUsers().subscribe(o=>{this.usuarios=o,console.log("Usuarios: ",this.usuarios)}),this.usuariosService.getRoles().subscribe(o=>{this.roles=o,console.log("Roles: ",this.roles)}),this.getRol()}searchUsuarios(o){const s=this.usuarios.filter(r=>r.username.toLowerCase().includes(o.query.toLowerCase()));this.filteredUsuarios=s}getRol(){this.usuariosService.getAllRoles().subscribe(o=>{this.AllRoles=o,this.procesarRoles()})}procesarRoles(){if(console.log("Iniciando procesarRoles con el nuevo formato..."),this.usuarioRolesMap.clear(),console.log("usuarioRolesMap limpiado."),this.AllRoles.forEach((o,s)=>{console.log(`Procesando asignaci\xf3n ${s}:`,o);const r=o.userId,t=o.rolesId;if(this.usuarioRolesMap.has(r)){const a=this.usuarioRolesMap.get(r)||[];a.push(t),this.usuarioRolesMap.set(r,Array.from(new Set(a)))}else this.usuarioRolesMap.set(r,[t])}),console.log("Mapa usuarioRolesMap final:",this.usuarioRolesMap),this.usuarioSeleccionado&&this.usuarioSeleccionado.username){const o=this.usuarioRolesMap.get(this.usuarioSeleccionado.username)||[];console.log(`Roles actuales del usuario seleccionado (${this.usuarioSeleccionado.username}):`,o),this.rolesSeleccionados=o.map(s=>{const r=this.roles.find(t=>t.name===s);return r?r.id:null}).filter(s=>null!==s),console.log("IDs de roles seleccionados:",this.rolesSeleccionados)}}onUsuarioSelect(o){if(this.usuarioSeleccionado=o,this.AllRoles.length>0){const s=this.usuarioRolesMap.get(this.usuarioSeleccionado.username)||[];this.rolesSeleccionados=s.map(r=>{const t=this.roles.find(a=>a.name===r);return t?t.id:null}).filter(r=>null!==r),console.log("Roles seleccionados al elegir usuario:",this.rolesSeleccionados)}}getAllRolesForUsuario(o){const s=[];return this.AllRoles.forEach(r=>{if(r.userId===o){const t=this.roles.find(a=>a.name===r.rolesId);t&&s.push(t.id)}}),s}isRolSelected(o){return this.rolesSeleccionados.some(s=>s===o.id)}onRolChange(o,s){const r=Number(o.id),t=o.name,a=this.usuarioSeleccionado.username;if(s){if(!this.rolesSeleccionados.includes(r)&&(this.rolesSeleccionados.push(r),!this.buscarUserRole(a,t))){const p=JSON.stringify({status:!0,userId:a,rolesId:t}),h={headers:new m.WM({"Content-Type":"application/json"})};this.usuariosService.asignarRoles(p,h).subscribe(x=>{this.messageService.add({severity:"success",summary:"Rol asignado satisfactoriamente"}),this.getRol()},x=>{console.error("Error al asignar el rol",x),this.messageService.add({severity:"error",summary:"Error al asignar el rol"})})}}else{const c=this.rolesSeleccionados.indexOf(r);if(-1!==c){this.rolesSeleccionados.splice(c,1);const d=this.buscarUserRole(a,t);if(!d)return void console.error("No se encontr\xf3 ning\xfan registro de user_roles coincidente");this.usuariosService.deleteUserRole(d.id).subscribe(()=>{this.messageService.add({severity:"success",summary:"Rol eliminado satisfactoriamente"}),this.getRol()},h=>{console.error("Error al eliminar el user_roles",h),this.messageService.add({severity:"error",summary:"Error al eliminar el rol"})})}}}asignarRol(){if(0===this.rolesSeleccionados.length)return;const o=this.rolesSeleccionados[this.rolesSeleccionados.length-1],s=this.roles.find(t=>t.id===o);if(!s)return void console.error("No se encontr\xf3 el rol con ID:",o);const r=this.buscarUserRole(this.usuarioSeleccionado.username,s.name);if(r)r.status||(r.status=!0,this.actualizarUserRole(r.id,r));else{const a=JSON.stringify({status:!0,userId:this.usuarioSeleccionado.username,rolesId:s.name}),c={headers:new m.WM({"Content-Type":"application/json"})};this.usuariosService.asignarRoles(a,c).subscribe(d=>{this.messageService.add({severity:"success",summary:"Rol asignado satisfactoriamente"}),this.getRol()},d=>{console.error("Error al asignar el rol",d),this.messageService.add({severity:"error",summary:"Error al asignar el rol"})})}}actualizarUserRole(o,s){const t=JSON.stringify({status:s.status,userId:s.userId,rolesId:s.rolesId}),a={headers:new m.WM({"Content-Type":"application/json"})};this.usuariosService.actualizarUserRole(o,t,a).subscribe(c=>{this.messageService.add({severity:"success",summary:"Rol actualizado satisfactoriamente"}),this.getRol()},c=>{console.error("Error al actualizar el rol",c),this.messageService.add({severity:"error",summary:"Error al actualizar el rol"})})}buscarUserRole(o,s){return this.AllRoles.find(r=>r.userId===o&&r.rolesId===s)}deleteUserRole(o){const t=this.buscarUserRole(this.usuarioSeleccionado.username,o.name);t?this.usuariosService.deleteUserRole(t.id).subscribe(()=>{this.messageService.add({severity:"success",summary:"Rol eliminado satisfactoriamente"}),this.getRol()},c=>{console.error("Error al eliminar el user_roles",c),this.messageService.add({severity:"error",summary:"Error al eliminar el rol"})}):console.error("No se encontr\xf3 ning\xfan registro de user_roles coincidente")}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(b.J),e.Y36(y.ez),e.Y36(m.eN))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-ver"]],decls:23,vars:7,consts:[[1,"roles-title"],[1,"container"],["name","usuarioForm",1,"form"],[1,"form-group"],["for","usuario"],["name","usuario","field","username","placeholder","Seleccionar usuario",3,"ngModel","suggestions","minLength","ngModelChange","completeMethod","onSelect"],["for","rol"],[4,"ngIf"],[1,"user-list"],[4,"ngFor","ngForOf"],[3,"inputId","value","binary","label","ngModel","name","ngModelChange"]],template:function(o,s){1&o&&(e.TgZ(0,"h2",0),e._uU(1,"ASIGNAR ROLES"),e.qZA(),e.TgZ(2,"div",1)(3,"form",2)(4,"div",3)(5,"label",4),e._uU(6,"Usuario:"),e.qZA(),e.TgZ(7,"p-autoComplete",5),e.NdJ("ngModelChange",function(t){return s.usuarioSeleccionado=t})("completeMethod",function(t){return s.searchUsuarios(t)})("onSelect",function(t){return s.onUsuarioSelect(t)}),e.qZA()(),e.TgZ(8,"div",3)(9,"label",6),e._uU(10,"Roles:"),e.qZA(),e.YNc(11,C,2,1,"div",7),e.qZA()()(),e.TgZ(12,"div",8)(13,"table")(14,"thead")(15,"tr")(16,"th"),e._uU(17,"Usuario"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Rol (roles)"),e.qZA()()(),e.TgZ(20,"tbody"),e.YNc(21,U,6,2,"ng-container",9),e.ALo(22,"keyvalue"),e.qZA()()()),2&o&&(e.xp6(7),e.Q6J("ngModel",s.usuarioSeleccionado)("suggestions",s.filteredUsuarios)("minLength",1),e.xp6(4),e.Q6J("ngIf",s.usuarioSeleccionado.username),e.xp6(10),e.Q6J("ngForOf",e.lcZ(22,5,s.usuarioRolesMap)))},dependencies:[g.sg,g.O5,S.XZ,u._Y,u.JJ,u.JL,u.On,u.F,R.Qc,g.Nd],styles:["[_ngcontent-%COMP%]:root{--primary-color: #0056b3;--primary-hover: #003d80;--background-light: #f8f9fa;--text-dark: #333;--border-color: #ddd;--shadow-light: rgba(0, 0, 0, .1);--shadow-medium: rgba(0, 0, 0, .15)}body[_ngcontent-%COMP%]{font-family:Inter,sans-serif;background:var(--background-light);color:var(--text-dark);margin:0;padding:0;display:flex;flex-direction:column;align-items:center}.container[_ngcontent-%COMP%]{max-width:500px;margin:30px auto;background:#ffffff;padding:25px;border-radius:12px;box-shadow:0 6px 12px var(--shadow-light);transition:transform .2s ease-in-out}.container[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.roles-title[_ngcontent-%COMP%]{text-align:center;color:var(--primary-color);text-transform:uppercase;font-size:28px;font-weight:700;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{font-weight:600;display:block;margin-bottom:6px;color:var(--text-dark)}.roles-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px}.role-item[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;padding:10px 15px;border-radius:6px;font-size:14px;transition:all .3s ease-in-out;cursor:pointer}.role-item[_ngcontent-%COMP%]:hover{background:var(--primary-hover);transform:scale(1.05)}.user-list[_ngcontent-%COMP%]{max-width:700px;margin:30px auto;padding:20px;background:white;border-radius:12px;box-shadow:0 4px 10px var(--shadow-light)}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:white;box-shadow:0 6px 12px var(--shadow-medium);border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;padding:14px;font-size:16px;text-align:left}td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid var(--border-color)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#f2f2f2}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#e0e0e0;transition:background .3s ease-in-out}button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;border:none;border-radius:6px;background:var(--primary-color);color:#fff;cursor:pointer;transition:background .3s ease-in-out}button[_ngcontent-%COMP%]:hover{background:var(--primary-hover)}@media (max-width: 768px){.container[_ngcontent-%COMP%], .user-list[_ngcontent-%COMP%]{width:90%;max-width:100%}table[_ngcontent-%COMP%]{display:block;overflow-x:auto}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{white-space:nowrap}}"]}),n})()}];let A=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[v.Bz.forChild(O),v.Bz]}),n})();var I=i(6697),P=i(845),Z=i(9114),E=i(8061),T=i(5315),w=i(1424),N=i(657),J=i(1497),z=i(6526),V=i(97),k=i(4036);let F=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.ez,A,S.nD,V.$,I.U$,P.hJ,Z.D,E.Q,T.S,w.j,u.u5,u.UX,N.kK,R.WN,J.EV,z.q4,k.kW]}),n})()}}]);