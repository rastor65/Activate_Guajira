"use strict";(self.webpackChunkAppTuristica=self.webpackChunkAppTuristica||[]).push([[837],{2837:(F,p,i)=>{i.r(p),i.d(p,{UserRolesModule:()=>E});var u=i(9808),m=i(620),g=i(520),e=i(4893),v=i(4738),x=i(9783),h=i(1208),d=i(3075),f=i(2145);function S(t,l){if(1&t){const o=e.EpF();e.TgZ(0,"div")(1,"p-checkbox",10),e.NdJ("ngModelChange",function(s){const a=e.CHM(o).$implicit,c=e.oxw(2);return e.KtG(c.onRolChange(a,s))}),e.qZA()()}if(2&t){const o=l.$implicit,r=e.oxw(2);e.xp6(1),e.Q6J("inputId","rol_"+o.id)("value",o.id.toString())("binary",!0)("label",o.name)("ngModel",r.isRolSelected(o))("name","rol_"+o.id)}}function b(t,l){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,S,2,6,"div",9),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.roles)}}function C(t,l){if(1&t&&(e.ynx(0),e.TgZ(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA()(),e.BQk()),2&t){const o=l.$implicit;e.xp6(3),e.Oqu(o.key),e.xp6(2),e.Oqu(o.value.join(", "))}}const M=[{path:"ver",component:(()=>{class t{constructor(o,r,s){this.usuariosService=o,this.messageService=r,this.http=s,this.usuarios=[],this.roles=[],this.usuarioSeleccionado={},this.AllRoles=[],this.usuarioRolesMap=new Map,this.filteredUsuarios=[],this.rolesSeleccionados=[],this.nuevosRolesSeleccionados=[]}ngOnInit(){this.usuariosService.getUsers().subscribe(o=>{this.usuarios=o}),this.usuariosService.getRoles().subscribe(o=>{this.roles=o}),this.procesarRoles(),this.getRol()}searchUsuarios(o){const r=this.usuarios.filter(s=>s.username.toLowerCase().includes(o.query.toLowerCase()));this.filteredUsuarios=r}getRol(){this.usuariosService.getAllRoles().subscribe(o=>{this.AllRoles=o,this.procesarRoles()})}procesarRoles(){this.usuarioRolesMap.clear(),this.AllRoles.forEach(r=>{const s=r.userId.username,n=Array.isArray(r.rolesId)?r.rolesId.map(a=>a.name):[r.rolesId.name];if(this.usuarioRolesMap.has(s)){const a=this.usuarioRolesMap.get(s)||[];a.push(...n),this.usuarioRolesMap.set(s,Array.from(new Set(a)))}else this.usuarioRolesMap.set(s,Array.from(new Set(n)))});const o=this.usuarioRolesMap.get(this.usuarioSeleccionado.username)||[];this.rolesSeleccionados=o.map(r=>{const s=this.roles.find(n=>n.name===r);return s?s.id:null})}onUsuarioSelect(o){this.usuarioSeleccionado=o,this.rolesSeleccionados=this.getAllRolesForUsuario(this.usuarioSeleccionado.id)}getAllRolesForUsuario(o){const r=[];return this.AllRoles.filter(n=>n.userId.id===o).forEach(n=>{r.push(n.rolesId.id)}),r}isRolSelected(o){return this.rolesSeleccionados.some(r=>r===o.id)}onRolChange(o,r){const s=Number(o.id);if(r)this.rolesSeleccionados.includes(s)||(this.rolesSeleccionados.push(s),this.asignarRol());else{const n=this.rolesSeleccionados.indexOf(s);if(-1!==n)return this.rolesSeleccionados.splice(n,1),void this.deleteUserRole(o)}}asignarRol(){if(0===this.rolesSeleccionados.length)return;const o=this.rolesSeleccionados[this.rolesSeleccionados.length-1],r=this.buscarUserRole(this.usuarioSeleccionado.id,o);if(r)r.status||(r.status=!0,this.actualizarUserRole(r.id,r));else{const n=JSON.stringify({status:!0,userId:this.usuarioSeleccionado.id,rolesId:o}),a={headers:new g.WM({"Content-Type":"application/json"})};this.usuariosService.asignarRoles(n,a).subscribe(c=>{this.messageService.add({severity:"success",summary:"Rol asignado satisfactoriamente"}),this.getAllRolesForUsuario(this.usuarioSeleccionado.id)},c=>{console.error("Error al asignar el rol",c),this.messageService.add({severity:"error",summary:"Error al asignar el rol"})})}}actualizarUserRole(o,r){const n=JSON.stringify({status:r.status,userId:r.userId.id,rolesId:r.rolesId.id}),a={headers:new g.WM({"Content-Type":"application/json"})};this.usuariosService.actualizarUserRole(o,n,a).subscribe(c=>{this.messageService.add({severity:"success",summary:"Rol actualizado satisfactoriamente"}),this.getAllRolesForUsuario(this.usuarioSeleccionado.id)},c=>{console.error("Error al actualizar el rol",c),this.messageService.add({severity:"error",summary:"Error al actualizar el rol"})})}buscarUserRole(o,r){return this.AllRoles.find(s=>s.userId.id===o&&s.rolesId.id===r)}deleteUserRole(o){const n=this.buscarUserRole(this.usuarioSeleccionado.id,o.id);n?this.usuariosService.deleteUserRole(n.id).subscribe(()=>{this.messageService.add({severity:"success",summary:"Rol eliminado satisfactoriamente"})},c=>{console.error("Error al eliminar el user_roles",c),this.messageService.add({severity:"error",summary:"Error al eliminar el rol"})}):console.error("No se encontr\xf3 ning\xfan registro de user_roles coincidente")}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(v.J),e.Y36(x.ez),e.Y36(g.eN))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-ver"]],decls:23,vars:7,consts:[[1,"roles-title"],[1,"container"],["name","usuarioForm",1,"form"],[1,"form-group"],["for","usuario"],["name","usuario","field","username","placeholder","Seleccionar usuario",3,"ngModel","suggestions","minLength","ngModelChange","completeMethod","onSelect"],["for","rol"],[4,"ngIf"],[1,"user-list"],[4,"ngFor","ngForOf"],[3,"inputId","value","binary","label","ngModel","name","ngModelChange"]],template:function(o,r){1&o&&(e.TgZ(0,"h2",0),e._uU(1,"ASIGNAR ROLES"),e.qZA(),e.TgZ(2,"div",1)(3,"form",2)(4,"div",3)(5,"label",4),e._uU(6,"Usuario:"),e.qZA(),e.TgZ(7,"p-autoComplete",5),e.NdJ("ngModelChange",function(n){return r.usuarioSeleccionado=n})("completeMethod",function(n){return r.searchUsuarios(n)})("onSelect",function(n){return r.onUsuarioSelect(n)}),e.qZA()(),e.TgZ(8,"div",3)(9,"label",6),e._uU(10,"Roles:"),e.qZA(),e.YNc(11,b,2,1,"div",7),e.qZA()()(),e.TgZ(12,"div",8)(13,"table")(14,"thead")(15,"tr")(16,"th"),e._uU(17,"Usuario"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Rol (roles)"),e.qZA()()(),e.TgZ(20,"tbody"),e.YNc(21,C,6,2,"ng-container",9),e.ALo(22,"keyvalue"),e.qZA()()()),2&o&&(e.xp6(7),e.Q6J("ngModel",r.usuarioSeleccionado)("suggestions",r.filteredUsuarios)("minLength",1),e.xp6(4),e.Q6J("ngIf",r.usuarioSeleccionado.username),e.xp6(10),e.Q6J("ngForOf",e.lcZ(22,5,r.usuarioRolesMap)))},dependencies:[u.sg,u.O5,h.XZ,d._Y,d.JJ,d.JL,d.On,d.F,f.Qc,u.Nd],styles:["[_ngcontent-%COMP%]:root{--primary-color: #0056b3;--primary-hover: #003d80;--background-light: #f8f9fa;--text-dark: #333;--border-color: #ddd;--shadow-light: rgba(0, 0, 0, .1);--shadow-medium: rgba(0, 0, 0, .15)}body[_ngcontent-%COMP%]{font-family:Inter,sans-serif;background:var(--background-light);color:var(--text-dark);margin:0;padding:0;display:flex;flex-direction:column;align-items:center}.container[_ngcontent-%COMP%]{max-width:500px;margin:30px auto;background:#ffffff;padding:25px;border-radius:12px;box-shadow:0 6px 12px var(--shadow-light);transition:transform .2s ease-in-out}.container[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.roles-title[_ngcontent-%COMP%]{text-align:center;color:var(--primary-color);text-transform:uppercase;font-size:28px;font-weight:700;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{font-weight:600;display:block;margin-bottom:6px;color:var(--text-dark)}.roles-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px}.role-item[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;padding:10px 15px;border-radius:6px;font-size:14px;transition:all .3s ease-in-out;cursor:pointer}.role-item[_ngcontent-%COMP%]:hover{background:var(--primary-hover);transform:scale(1.05)}.user-list[_ngcontent-%COMP%]{max-width:700px;margin:30px auto;padding:20px;background:white;border-radius:12px;box-shadow:0 4px 10px var(--shadow-light)}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:white;box-shadow:0 6px 12px var(--shadow-medium);border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;padding:14px;font-size:16px;text-align:left}td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid var(--border-color)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#f2f2f2}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#e0e0e0;transition:background .3s ease-in-out}button[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;border:none;border-radius:6px;background:var(--primary-color);color:#fff;cursor:pointer;transition:background .3s ease-in-out}button[_ngcontent-%COMP%]:hover{background:var(--primary-hover)}@media (max-width: 768px){.container[_ngcontent-%COMP%], .user-list[_ngcontent-%COMP%]{width:90%;max-width:100%}table[_ngcontent-%COMP%]{display:block;overflow-x:auto}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{white-space:nowrap}}"]}),t})()}];let R=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[m.Bz.forChild(M),m.Bz]}),t})();var y=i(6697),U=i(845),O=i(9114),A=i(8061),I=i(5315),P=i(1424),Z=i(657),T=i(1497),w=i(6526),J=i(97),z=i(4036);let E=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[u.ez,R,h.nD,J.$,y.U$,U.hJ,O.D,A.Q,I.S,P.j,d.u5,d.UX,Z.kK,f.WN,T.EV,w.q4,z.kW]}),t})()}}]);